{"version":3,"sources":["../index.js"],"names":["subscribe","connect","reduce","action","merge","currentState","reducers","dispatching","actionQueue","actionQueueEmpty","subscribers","end","configs","stateProcessor","nextState","notifyChange","subscriber","isClass","v","test","toString","configure","newConfigs","Object","assign","shallowEqual","value1","value2","Date","getTime","Array","isArray","length","i","value1Keys","keys","key","push","index","indexOf","splice","stateToProps","state","props","dispatchToProps","undefined","mapProps","Component","isStatelessComponent","mappedProps","margeProps","unsubscribe","nextMappedProps","ex","forceUpdate","finalProps","nextProps","React","createElement","callReducer","reducer","payload","addRootReducer","addReducerForSingleAction","forAction","addReducerForMultipleActions","forActions","arguments","slice","call","processActionQueue","queueItem","shift","dispatch","type","dispatcher"],"mappings":"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","file":"index.js","sourcesContent":["import React from 'react';\r\n\r\nlet currentState = {};\r\nconst reducers = [];\r\nlet dispatching = false;\r\nconst actionQueue = [];\r\nlet actionQueueEmpty = true;\r\nconst subscribers = [];\r\nconst end = {};\r\nconst configs = {\r\n  stateProcessor(currentState, nextState) {\r\n    return nextState;\r\n  }\r\n};\r\n\r\nfunction notifyChange() {\r\n  for (let subscriber of subscribers) {\r\n    if (!actionQueueEmpty) {\r\n      break;\r\n    }\r\n    subscriber(currentState);\r\n  }\r\n}\r\n\r\nfunction isClass(v) {\r\n  return typeof v === 'function' && /^\\s*class\\s+/.test(v.toString());\r\n}\r\n\r\nfunction configure(newConfigs) {\r\n  Object.assign(configs, newConfigs);\r\n}\r\n\r\nfunction shallowEqual(value1, value2) {\r\n  if (value1 === value2) return true;\r\n  if (value1 instanceof Date && value2 instanceof Date) {\r\n    return value1.getTime() === value2.getTime();\r\n  }\r\n  if (value1 && value2) {\r\n    if (Array.isArray(value1)) {\r\n      const length = value1.length;\r\n      if (length !== value2.length) return false;\r\n      for (let i = 0; i < length; i++) {\r\n        if (value1[i] !== value2[i]) return false;\r\n      }\r\n      return true;\r\n    }\r\n    const value1Keys = Object.keys(value1);\r\n    if (value1Keys.length !== Object.keys(value2).length) return false;\r\n    for (let key of value1Keys) {\r\n      if (value1[key] !== value2[key]) return false;\r\n    }\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function subscribe(subscriber) {\r\n  subscribers.push(subscriber);\r\n  return function() {\r\n    const index = subscribers.indexOf(subscriber);\r\n    if (index !== -1) {\r\n      subscribers.splice(index, 1);\r\n    }\r\n  };\r\n}\r\n\r\nexport function connect(\r\n  stateToProps = (state, props) => props,\r\n  dispatchToProps = props => undefined\r\n) {\r\n  function mapProps(props) {\r\n    return stateToProps(currentState, props);\r\n  }\r\n\r\n  return function(Component) {\r\n    const isStatelessComponent = !isClass(Component);\r\n    return class ComponentWrapper extends React.Component {\r\n      constructor(props) {\r\n        super(props);\r\n        this.mappedProps = mapProps(this.props);\r\n        this.margeProps();\r\n        this.unsubscribe = subscribe(() => {\r\n          let nextMappedProps;\r\n          try {\r\n            nextMappedProps = mapProps(this.props);\r\n          } catch (ex) {\r\n            return;\r\n          }\r\n          if (shallowEqual(nextMappedProps, this.mappedProps)) return;\r\n          this.mappedProps = nextMappedProps;\r\n          this.margeProps();\r\n          this.forceUpdate();\r\n        });\r\n      }\r\n\r\n      margeProps() {\r\n        this.finalProps = Object.assign(\r\n          {},\r\n          this.mappedProps,\r\n          dispatchToProps(this.mappedProps)\r\n        );\r\n      }\r\n\r\n      shouldComponentUpdate(nextProps) {\r\n        const nextMappedProps = mapProps(nextProps);\r\n        if (shallowEqual(nextMappedProps, this.mappedProps)) return false;\r\n        this.mappedProps = nextMappedProps;\r\n        this.margeProps();\r\n        return true;\r\n      }\r\n\r\n      componentWillUnmount() {\r\n        if (this.unsubscribe) {\r\n          this.unsubscribe();\r\n        }\r\n      }\r\n      render() {\r\n        if (isStatelessComponent) {\r\n          return Component(this.finalProps, this);\r\n        }\r\n        return React.createElement(Component, this.finalProps);\r\n      }\r\n    };\r\n  };\r\n}\r\n\r\nfunction callReducer(reducer, state, action, payload) {\r\n  let nextState = reducer(state, action, payload);\r\n\r\n  if (nextState === end) return end;\r\n\r\n  if (nextState === null || nextState === undefined) {\r\n    nextState = state;\r\n  }\r\n\r\n  if (state !== nextState) {\r\n    nextState = configs.stateProcessor(state, nextState);\r\n  }\r\n\r\n  return nextState;\r\n}\r\n\r\nfunction addRootReducer(reducer) {\r\n  reducers.push(reducer);\r\n}\r\n\r\nfunction addReducerForSingleAction(forAction, reducer) {\r\n  return addRootReducer(\r\n    (state, action, payload) =>\r\n      action === forAction ? reducer(payload, state, action) : state\r\n  );\r\n}\r\n\r\nfunction addReducerForMultipleActions(forActions, reducer) {\r\n  return addRootReducer(\r\n    (state, action, payload) =>\r\n      forActions.indexOf(action) !== -1\r\n        ? reducer(payload, state, action)\r\n        : state\r\n  );\r\n}\r\n\r\nexport function reduce() {\r\n  if (arguments.length === 1) {\r\n    return addRootReducer(arguments[0]);\r\n  }\r\n\r\n  if (arguments.length === 2) {\r\n    return addReducerForSingleAction(arguments[0], arguments[1]);\r\n  }\r\n\r\n  return addReducerForMultipleActions(\r\n    [].slice.call(arguments, 0, arguments.length - 1),\r\n    arguments[arguments.length - 1]\r\n  );\r\n}\r\n\r\nfunction processActionQueue() {\r\n  if (dispatching) return;\r\n  dispatching = true;\r\n  let nextState = currentState;\r\n  while (actionQueue.length) {\r\n    const queueItem = actionQueue.shift();\r\n    for (let i = 0; i < reducers.length; i++) {\r\n      nextState = callReducer(\r\n        reducers[i],\r\n        nextState,\r\n        queueItem.action,\r\n        queueItem.payload\r\n      );\r\n      if (nextState === end) break;\r\n    }\r\n\r\n    if (nextState === end) {\r\n      actionQueue.length = 0;\r\n      break;\r\n    }\r\n  }\r\n\r\n  actionQueueEmpty = true;\r\n  if (nextState === end) return;\r\n  if (nextState !== currentState) {\r\n    currentState = nextState;\r\n    notifyChange();\r\n  }\r\n\r\n  dispatching = false;\r\n\r\n  if (!actionQueueEmpty) {\r\n    processActionQueue();\r\n  }\r\n}\r\n\r\nfunction dispatch(action, payload) {\r\n  actionQueue.push({ action, payload });\r\n  actionQueueEmpty = false;\r\n  processActionQueue();\r\n}\r\n\r\nexport function action(type) {\r\n  const reducer = typeof type === 'function' ? type : undefined;\r\n\r\n  const dispatcher = function(payload) {\r\n    dispatch(type, payload);\r\n  };\r\n\r\n  if (type === undefined) {\r\n    type = dispatcher;\r\n  }\r\n\r\n  // register reducer for this action type\r\n  if (reducer) {\r\n    addReducerForSingleAction(type, reducer);\r\n  }\r\n\r\n  return dispatcher;\r\n}\r\n\r\nexport function merge(state) {\r\n  Object.assign(currentState, state);\r\n}\r\n\r\nexport default {\r\n  connect,\r\n  reduce,\r\n  action,\r\n  merge,\r\n  subscribe,\r\n  configure,\r\n  end\r\n};"]}